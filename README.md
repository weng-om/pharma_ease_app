# 药送送 - 药店管理系统产品报告

## 一、产品功能介绍

药送送是一款基于Flutter开发的药店管理Mini App，主要功能包括：

### 1.1 用户系统
- **用户注册**：支持手机号注册，包含用户名、手机号、密码验证
- **用户登录**：支持手机号和密码登录，自动保存登录状态
- **用户信息管理**：查看和修改个人信息，包括用户名、手机号
- **账户安全**：支持退出登录和注销账户功能

### 1.2 商品管理
- **商品分类浏览**：支持10种药品分类（五官用药、感冒用药、钙片等）
- **商品搜索**：支持按商品名称搜索
- **商品详情**：展示商品图片、名称、价格等信息
- **购物车功能**：添加商品到购物车、修改数量、删除商品

### 1.3 订单管理
- **订单结算**：使用佣金余额支付订单
- **订单记录**：查看已完成订单、待发货订单
- **礼金系统**：购物返礼金，支持礼金兑换商品
- **交易记录**：查看佣金收支明细、礼金收支明细

### 1.4 礼金商城
- **礼金商品**：展示可兑换的商品列表
- **礼金兑换**：使用礼金兑换商品
- **兑换记录**：查看历史兑换记录
- **礼金明细**：查看礼金获取和消费记录

### 1.5 其他功能
- **首页Banner**：自动轮播展示促销信息
- **充值功能**：模拟扫码充值，增加佣金余额
- **启动页**：自动检测登录状态并跳转

---

## 二、程序概要设计

### 2.1 设计目标
- 打造一个简洁、易用的药店管理应用
- 实现完整的购物流程：浏览→加购→结算→收货
- 提供灵活的支付方式：佣金支付、礼金兑换
- 确保良好的用户体验：流畅的页面切换、清晰的信息展示

### 2.2 设计原则
- **简洁性**：界面设计简洁明了，操作流程简单直观
- **一致性**：统一的配色方案（青绿色系）和交互方式
- **响应性**：快速响应用户操作，提供即时反馈
- **可扩展性**：模块化设计，便于功能扩展

### 2.3 用户体验设计
- **视觉设计**：采用清新的青绿色主题，营造健康、专业的药店形象
- **交互设计**：底部导航栏实现快速页面切换，手势操作支持商品滑动
- **反馈机制**：操作成功/失败都有明确的提示信息
- **加载状态**：数据加载时显示加载动画，提升用户体验

---

## 三、软件架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                      药送送应用架构                          │
└─────────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    表现层 (Presentation Layer)                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │  首页   │  │ 商品列表  │  │ 购物车   │   │
│  │HomeScreen│  │Product   │  │CartScreen│   │
│  └──────────┘  │Screen    │  └──────────┘   │
│                 └──────────┘                   │
│  ┌──────────┐  ┌──────────┐                 │
│  │ 礼金商城 │  │ 个人中心  │                 │
│  │GiftMall  │  │Profile   │                 │
│  │Screen    │  │Screen    │                 │
│  └──────────┘  └──────────┘                 │
│  ┌────────────────────────────────────────────┐    │
│  │          MainPage (主页面框架)          │    │
│  │    - 底部导航栏                    │    │
│  │    - 页面切换逻辑                  │    │
│  └────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    业务逻辑层 (Business Layer)                  │
│  ┌────────────────────────────────────────────┐    │
│  │         DataManager (数据管理单例)      │    │
│  │  - 用户管理 (登录/注册/注销)        │    │
│  │  - 商品管理 (获取/搜索/分类)          │    │
│  │  - 购物车管理 (添加/删除/结算)        │    │
│  │  - 礼金管理 (兑换/记录/明细)          │    │
│  │  - 订单管理 (创建/查询)              │    │
│  └────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    数据模型层 (Model Layer)                     │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  │
│  │ Product  │  │ CartItem │  │  User    │  │
│  │ (商品)   │  │(购物车项)│  │ (用户)   │  │
│  └──────────┘  └──────────┘  └──────────┘  │
│  - 数据序列化 (toJson)                      │
│  - 数据反序列化 (fromJson)                  │
└─────────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    数据持久层 (Persistence Layer)                │
│  ┌────────────────────────────────────────────┐    │
│  │      SharedPreferences (本地存储)        │    │
│  │  - 用户登录状态                      │    │
│  │  - 用户信息 (姓名/礼金/佣金)         │    │
│  │  - 购物车数据                      │    │
│  │  - 订单记录                          │    │
│  │  - 礼金记录                          │    │
│  └────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    网络数据层 (Network Layer)                    │
│  ┌────────────────────────────────────────────┐    │
│  │  HTTP请求 (商品图片/Banner)         │    │
│  │  - 图片缓存                          │    │
│  │  - 错误处理                          │    │
│  └────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 四、技术亮点及其实现原理

### 4.1 单例模式的数据管理
**技术亮点**：使用单例模式实现全局数据管理

**实现原理**：
```dart
class DataManager {
  static final DataManager _instance = DataManager._internal();
  factory DataManager() => _instance;
  DataManager._internal();

  // 所有数据操作方法
  Future<void> addToCart(Product product) async { }
  Future<User> loadUser() async { }
  // ...
}
```

**优势**：
- 全局唯一实例，避免数据不一致
- 统一的数据访问接口，便于维护
- 跨页面数据共享，无需传递参数

### 4.2 异步数据加载与状态管理
**技术亮点**：使用Future/async-await实现异步数据加载

**实现原理**：
```dart
Future<void> _loadData() async {
  try {
    final products = await DataManager().fetchProducts();
    if (mounted) {
      setState(() {
        this.products = products;
      });
    }
  } catch (e) {
    // 错误处理
  }
}
```

**优势**：
- 不阻塞UI线程，保证界面流畅
- 完善的错误处理机制
- mounted检查避免内存泄漏

### 4.3 本地数据持久化
**技术亮点**：使用SharedPreferences实现本地数据存储

**实现原理**：
```dart
// 保存数据
final prefs = await SharedPreferences.getInstance();
await prefs.setString('key', value);
await prefs.setDouble('key', value);

// 读取数据
final value = prefs.getString('key');
```

**应用场景**：
- 用户登录状态持久化
- 购物车数据本地存储
- 用户信息（礼金/佣金）保存
- 订单记录存储

### 4.4 网络图片加载与缓存
**技术亮点**：使用cached_network_image实现图片缓存

**实现原理**：
```dart
CachedNetworkImage(
  imageUrl: imageUrl,
  placeholder: (context, url) => CircularProgressIndicator(),
  errorWidget: (context, url, error) => Icon(Icons.error),
)
```

**优势**：
- 自动缓存已加载图片，减少网络请求
- 占位符和错误处理提升用户体验
- 支持渐入动画，视觉效果更流畅

### 4.5 页面路由与参数传递
**技术亮点**：使用命名路由和参数传递实现页面跳转

**实现原理**：
```dart
Navigator.pushAndRemoveUntil(
  context,
  MaterialPageRoute(
    builder: (context) => MainPage(
      initialTab: 1,
      category: categoryName,
      searchQuery: searchQuery,
    )
  ),
  (route) => false,
);
```

**优势**：
- 支持页面栈管理，实现跳转后清空历史
- 灵活的参数传递机制
- 类型安全的路由跳转

### 4.6 响应式布局与自适应
**技术亮点**：使用Flutter的响应式布局特性

**实现原理**：
```dart
GridView.builder(
  gridDelegate: SliverGridDelegateWithFixedCrossAxisCount(
    crossAxisCount: MediaQuery.of(context).size.width > 600 ? 3 : 2,
    childAspectRatio: 0.7,
  ),
)
```

**优势**：
- 自适应不同屏幕尺寸
- 保持良好的视觉效果
- 提升大屏设备的使用体验

### 4.7 错误处理与用户反馈
**技术亮点**：完善的错误处理和用户反馈机制

**实现原理**：
```dart
try {
  final result = await someOperation();
  if (result) {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('操作成功'))
    );
  } else {
    ScaffoldMessenger.of(context).showSnackBar(
      SnackBar(content: Text('操作失败'))
    );
  }
} catch (e) {
  debugPrint('错误: $e');
  // 显示错误提示
}
```

**优势**：
- 全面的异常捕获和处理
- 清晰的用户反馈机制
- 便于问题定位和调试

### 4.8 资源管理与性能优化
**技术亮点**：合理的资源管理和性能优化

**实现原理**：
```dart
@override
void dispose() {
  _timer?.cancel();
  _controller.dispose();
  super.dispose();
}
```

**优势**：
- 避免内存泄漏
- 及时释放资源
- 提升应用性能和稳定性
